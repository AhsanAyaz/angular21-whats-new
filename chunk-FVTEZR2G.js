import{a as Ye,b as We,c as D,d as Ze,e as Qe,f as Je,g as et,h as tt,i as le,k as nt,l as rt,m as it,o as st}from"./chunk-ZN6ZIJWF.js";import"./chunk-WB2TUUU2.js";import{$a as k,Ab as c,Cb as G,Fb as Be,Ia as je,Jb as ze,L as h,Lb as de,Ma as Ve,Mb as ue,Oa as Ue,Qb as o,R as ne,Rb as x,T as S,Vb as $e,X as re,a as m,aa as I,ab as ie,b as ee,bb as Ge,cb as V,d as te,db as U,hb as se,ib as u,ic as qe,ja as w,jb as d,jc as Xe,ka as j,kb as F,la as f,pa as Ke,qb as ae,ra as Le,sb as He,ya as g,zb as oe}from"./chunk-74OKKCYJ.js";var ce=0;function Et(){return ce}function N(t,e){return(...n)=>{try{return ce=e,t(...n)}finally{ce=0}}}function Mt(t){return!t}function at(t){return t}function p(t){return Array.isArray(t)}function R(t){return(typeof t=="object"||typeof t=="function")&&t!=null}var M=Symbol(),W=Symbol(),O=class{predicates;fns=[];constructor(e){this.predicates=e}push(e){this.fns.push(ot(this.predicates,e))}mergeIn(e){let n=this.predicates?e.fns.map(r=>ot(this.predicates,r)):e.fns;this.fns.push(...n)}},B=class extends O{get defaultValue(){return!1}compute(e){return this.fns.some(n=>{let r=n(e);return r&&r!==W})}},C=class t extends O{ignore;static ignoreNull(e){return new t(e,n=>n===null)}constructor(e,n){super(e),this.ignore=n}get defaultValue(){return[]}compute(e){return this.fns.reduce((n,r)=>{let i=r(e);return i===void 0||i===W?n:p(i)?[...n,...this.ignore?i.filter(s=>!this.ignore(s)):i]:this.ignore&&this.ignore(i)?n:[...n,i]},[])}},he=class extends C{constructor(e){super(e,void 0)}},fe=class extends O{key;get defaultValue(){return this.key.reducer.getInitial()}constructor(e,n){super(e),this.key=n}compute(e){if(this.fns.length===0)return this.key.reducer.getInitial();let n=this.key.reducer.getInitial();for(let r=0;r<this.fns.length;r++){let i=this.fns[r](e);i!==W&&(n=this.key.reducer.reduce(n,i))}return n}};function ot(t,e){return t.length===0?e:n=>{for(let r of t){let i=n.stateOf(r.path),s=f(i.structure.pathKeys).length-r.depth;for(let a=0;a<s;a++)i=i.structure.parent;if(!r.fn(i.context))return W}return e(n)}}var P=class{predicates;hidden;disabledReasons;readonly;syncErrors;syncTreeErrors;asyncErrors;metadata=new Map;constructor(e){this.predicates=e,this.hidden=new B(e),this.disabledReasons=new he(e),this.readonly=new B(e),this.syncErrors=C.ignoreNull(e),this.syncTreeErrors=C.ignoreNull(e),this.asyncErrors=C.ignoreNull(e)}hasMetadata(e){return this.metadata.has(e)}getMetadataKeys(){return this.metadata.keys()}getMetadata(e){return this.metadata.has(e)||this.metadata.set(e,new fe(this.predicates,e)),this.metadata.get(e)}mergeIn(e){this.hidden.mergeIn(e.hidden),this.disabledReasons.mergeIn(e.disabledReasons),this.readonly.mergeIn(e.readonly),this.syncErrors.mergeIn(e.syncErrors),this.syncTreeErrors.mergeIn(e.syncTreeErrors),this.asyncErrors.mergeIn(e.asyncErrors);for(let n of e.getMetadataKeys()){let r=e.metadata.get(n);this.getMetadata(n).mergeIn(r)}}},z=class{depth;constructor(e){this.depth=e}build(){return new $(this,[],0)}},T=class t extends z{constructor(e){super(e)}current;all=[];addHiddenRule(e){this.getCurrent().addHiddenRule(e)}addDisabledReasonRule(e){this.getCurrent().addDisabledReasonRule(e)}addReadonlyRule(e){this.getCurrent().addReadonlyRule(e)}addSyncErrorRule(e){this.getCurrent().addSyncErrorRule(e)}addSyncTreeErrorRule(e){this.getCurrent().addSyncTreeErrorRule(e)}addAsyncErrorRule(e){this.getCurrent().addAsyncErrorRule(e)}addMetadataRule(e,n){this.getCurrent().addMetadataRule(e,n)}getChild(e){if(e===M){let n=this.getCurrent().children;n.size>(n.has(M)?1:0)&&(this.current=void 0)}return this.getCurrent().getChild(e)}hasLogic(e){return this===e?!0:this.all.some(({builder:n})=>n.hasLogic(e))}mergeIn(e,n){n?this.all.push({builder:e,predicate:{fn:N(n.fn,this.depth),path:n.path}}):this.all.push({builder:e}),this.current=void 0}getCurrent(){return this.current===void 0&&(this.current=new K(this.depth),this.all.push({builder:this.current})),this.current}static newRoot(){return new t(0)}},K=class extends z{logic=new P([]);children=new Map;constructor(e){super(e)}addHiddenRule(e){this.logic.hidden.push(N(e,this.depth))}addDisabledReasonRule(e){this.logic.disabledReasons.push(N(e,this.depth))}addReadonlyRule(e){this.logic.readonly.push(N(e,this.depth))}addSyncErrorRule(e){this.logic.syncErrors.push(N(e,this.depth))}addSyncTreeErrorRule(e){this.logic.syncTreeErrors.push(N(e,this.depth))}addAsyncErrorRule(e){this.logic.asyncErrors.push(N(e,this.depth))}addMetadataRule(e,n){this.logic.getMetadata(e).push(N(n,this.depth))}getChild(e){return this.children.has(e)||this.children.set(e,new T(this.depth+1)),this.children.get(e)}hasLogic(e){return this===e}},$=class t{builder;predicates;depth;logic;constructor(e,n,r){this.builder=e,this.predicates=n,this.depth=r,this.logic=e?Dt(e,n,r):new P([])}getChild(e){let n=this.builder?dt(this.builder,e):[];if(n.length===0)return new t(void 0,[],this.depth+1);if(n.length===1){let{builder:r,predicates:i}=n[0];return new t(r,[...this.predicates,...i.map(s=>ge(s,this.depth))],this.depth+1)}else{let r=n.map(({builder:i,predicates:s})=>new t(i,[...this.predicates,...s.map(a=>ge(a,this.depth))],this.depth+1));return new me(r)}}hasLogic(e){return this.builder?.hasLogic(e)??!1}},me=class t{all;logic;constructor(e){this.all=e,this.logic=new P([]);for(let n of e)this.logic.mergeIn(n.logic)}getChild(e){return new t(this.all.flatMap(n=>n.getChild(e)))}hasLogic(e){return this.all.some(n=>n.hasLogic(e))}};function dt(t,e){if(t instanceof T)return t.all.flatMap(({builder:n,predicate:r})=>{let i=dt(n,e);return r?i.map(({builder:s,predicates:a})=>({builder:s,predicates:[...a,r]})):i});if(t instanceof K)return[...e!==M&&t.children.has(M)?[{builder:t.getChild(M),predicates:[]}]:[],...t.children.has(e)?[{builder:t.getChild(e),predicates:[]}]:[]];throw new h(1909,!1)}function Dt(t,e,n){let r=new P(e);if(t instanceof T){let i=t.all.map(({builder:s,predicate:a})=>new $(s,a?[...e,ge(a,n)]:e,n));for(let s of i)r.mergeIn(s.logic)}else if(t instanceof K)r.mergeIn(t.logic);else throw new h(1909,!1);return r}function ge(t,e){return ee(m({},t),{depth:e})}var ut=Symbol("PATH"),b=class t{keys;parent;keyInParent;root;children=new Map;fieldPathProxy=new Proxy(this,Rt);logicBuilder;constructor(e,n,r,i){this.keys=e,this.parent=r,this.keyInParent=i,this.root=n??this,r||(this.logicBuilder=T.newRoot())}get builder(){return this.logicBuilder?this.logicBuilder:this.parent.builder.getChild(this.keyInParent)}getChild(e){return this.children.has(e)||this.children.set(e,new t([...this.keys,e],this.root,this,e)),this.children.get(e)}mergeIn(e,n){let r=e.compile();this.builder.mergeIn(r.builder,n)}static unwrapFieldPath(e){return e[ut]}static newRoot(){return new t([],void 0,void 0,void 0)}},Rt={get(t,e){return e===ut?t:t.getChild(e).fieldPathProxy}},H,_=new Map,q=class t{schemaFn;constructor(e){this.schemaFn=e}compile(){if(_.has(this))return _.get(this);let e=b.newRoot();_.set(this,e);let n=H;try{H=e,this.schemaFn(e.fieldPathProxy)}finally{H=n}return e}static create(e){return e instanceof t?e:new t(e)}static rootCompile(e){try{return _.clear(),e===void 0?b.newRoot():e instanceof t?e.compile():new t(e).compile()}finally{_.clear()}}};function Ct(t){return t instanceof q||typeof t=="function"}function Re(t){if(H!==b.unwrapFieldPath(t).root)throw new h(1908,!1)}function Ce(t,e,n){return Re(t),b.unwrapFieldPath(t).builder.addMetadataRule(e,n),e}var E={list(){return{reduce:(t,e)=>e===void 0?t:[...t,e],getInitial:()=>[]}},min(){return{reduce:(t,e)=>t===void 0||e===void 0?t??e:Math.min(t,e),getInitial:()=>{}}},max(){return{reduce:(t,e)=>t===void 0||e===void 0?t??e:Math.max(t,e),getInitial:()=>{}}},or(){return{reduce:(t,e)=>t||e,getInitial:()=>!1}},and(){return{reduce:(t,e)=>t&&e,getInitial:()=>!0}},override:Pt};function Pt(t){return{reduce:(e,n)=>n,getInitial:()=>t?.()}}var X=class{reducer;create;brand;constructor(e,n){this.reducer=e,this.create=n}};function v(t){return new X(t??E.override())}var Pe=v(E.or()),lt=v(E.max()),ct=v(E.min()),ht=v(E.max()),ft=v(E.min()),mt=v(E.list());function Tt(t){return t.errors().length>0?"invalid":t.pending()?"unknown":"valid"}var pe=class{node;constructor(e){this.node=e}rawSyncTreeErrors=o(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncTreeErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawSyncTreeErrors()??[]]);syncErrors=o(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncErrors.compute(this.node.context),...this.syncTreeErrors(),...At(this.node.submitState.serverErrors())]);syncValid=o(()=>this.shouldSkipValidation()?!0:this.node.structure.reduceChildren(this.syncErrors().length===0,(e,n)=>n&&e.validationState.syncValid(),Mt));syncTreeErrors=o(()=>this.rawSyncTreeErrors().filter(e=>e.fieldTree===this.node.fieldProxy));rawAsyncErrors=o(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.asyncErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawAsyncErrors()??[]]);asyncErrors=o(()=>this.shouldSkipValidation()?[]:this.rawAsyncErrors().filter(e=>e==="pending"||e.fieldTree===this.node.fieldProxy));errors=o(()=>[...this.syncErrors(),...this.asyncErrors().filter(e=>e!=="pending")]);errorSummary=o(()=>this.node.structure.reduceChildren(this.errors(),(e,n)=>[...n,...e.errorSummary()]));pending=o(()=>this.node.structure.reduceChildren(this.asyncErrors().includes("pending"),(e,n)=>n||e.validationState.asyncErrors().includes("pending")));status=o(()=>{if(this.shouldSkipValidation())return"valid";let e=Tt(this);return this.node.structure.reduceChildren(e,(n,r)=>r==="invalid"||n.validationState.status()==="invalid"?"invalid":r==="unknown"||n.validationState.status()==="unknown"?"unknown":"valid",n=>n==="invalid")});valid=o(()=>this.status()==="valid");invalid=o(()=>this.status()==="invalid");shouldSkipValidation=o(()=>this.node.hidden()||this.node.disabled()||this.node.readonly())};function At(t){return t===void 0?[]:p(t)?t:[t]}function Te(t,e){if(p(t))for(let n of t)n.fieldTree??=e;else t&&(t.fieldTree??=e);return t}var ye=v(),be=class{node;cache=new WeakMap;constructor(e){this.node=e}resolve(e){if(!this.cache.has(e)){let n=o(()=>{let r=b.unwrapFieldPath(e),i=this.node,s=Et();for(;s>0||!i.structure.logic.hasLogic(r.root.builder);)if(s--,i=i.structure.parent,i===void 0)throw new h(1900,!1);for(let a of r.keys)if(i=i.structure.getChild(a),i===void 0)throw new h(1901,!1);return i.fieldProxy});this.cache.set(e,n)}return this.cache.get(e)()}get fieldTree(){return this.node.fieldProxy}get state(){return this.node}get value(){return this.node.structure.value}get key(){return this.node.structure.keyInParent}get pathKeys(){return this.node.structure.pathKeys}index=o(()=>{let e=this.key();if(!p(f(this.node.structure.parent.value)))throw new h(1906,!1);return Number(e)});fieldTreeOf=e=>this.resolve(e);stateOf=e=>this.resolve(e)();valueOf=e=>{let n=this.resolve(e)().value();if(n instanceof et)throw new h(1907,!1);return n}},ve=class{node;metadata=new Map;constructor(e){this.node=e;for(let n of this.node.logicNode.logic.getMetadataKeys())if(n.create){let r=this.node.logicNode.logic.getMetadata(n),i=f(()=>re(this.node.structure.injector,()=>n.create(o(()=>r.compute(this.node.context)))));this.metadata.set(n,i)}}get(e){if(this.has(e)&&!this.metadata.has(e)){if(e.create)throw Error("Managed metadata cannot be created lazily");let n=this.node.logicNode.logic.getMetadata(e);this.metadata.set(e,o(()=>n.compute(this.node.context)))}return this.metadata.get(e)}has(e){return this.node.logicNode.logic.hasMetadata(e)}},It={get(t,e,n){let r=t(),i=r.structure.getChild(e);if(i!==void 0)return i.fieldProxy;let s=f(r.value);if(p(s)){if(e==="length")return r.value().length;if(e===Symbol.iterator)return()=>(r.value(),Array.prototype[Symbol.iterator].apply(r.fieldProxy))}if(R(s)&&e===Symbol.iterator)return function*(){for(let a in n)yield[a,n[a]]}},getOwnPropertyDescriptor(t,e){let n=f(t().value),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&!r.configurable&&(r.configurable=!0),r},ownKeys(t){let e=f(t().value);return typeof e=="object"&&e!==null?Reflect.ownKeys(e):[]}};function kt(t,e){let n=o(()=>t()[e()]);return n[te]=t[te],n.set=r=>{t.update(i=>Ft(i,r,e()))},n.update=r=>{n.set(r(f(n)))},n.asReadonly=()=>n,n}function Ft(t,e,n){if(p(t)){let r=[...t];return r[n]=e,r}else return ee(m({},t),{[n]:e})}var Y=class{logic;node;createChildNode;identitySymbol=Symbol();_injector=void 0;get injector(){return this._injector??=I.create({providers:[],parent:this.fieldManager.injector}),this._injector}constructor(e,n,r){this.logic=e,this.node=n,this.createChildNode=r}children(){let e=this.childrenMap();return e===void 0?[]:Array.from(e.byPropertyKey.values()).map(n=>f(n.reader))}getChild(e){let n=e.toString(),r=f(this.childrenMap)?.byPropertyKey.get(n)?.reader;return r||(r=this.createReader(n)),r()}reduceChildren(e,n,r){let i=this.childrenMap();if(!i)return e;let s=e;for(let a of i.byPropertyKey.values()){if(r?.(s))break;s=n(f(a.reader),s)}return s}destroy(){this.injector.destroy()}createKeyInParent(e,n,r){if(e.kind==="root")return gt;if(n===void 0){let i=r;return o(()=>{if(this.parent.structure.getChild(i)!==this.node)throw new h(1902,!1);return i})}else{let i=r;return o(()=>{let s=this.parent.structure.value();if(!p(s))throw new h(1903,!1);let a=s[i];if(R(a)&&a.hasOwnProperty(this.parent.structure.identitySymbol)&&a[this.parent.structure.identitySymbol]===n)return i;for(let l=0;l<s.length;l++){let y=s[l];if(R(y)&&y.hasOwnProperty(this.parent.structure.identitySymbol)&&y[this.parent.structure.identitySymbol]===n)return i=l.toString()}throw new h(1904,!1)})}}createChildrenMap(){return x({source:this.value,computation:(e,n)=>{if(!R(e))return;let r=n?.value??{byPropertyKey:new Map},i,s=p(e);r!==void 0&&(s?i=_t(r,e,this.identitySymbol):i=Ot(r,e));for(let a of Object.keys(e)){let l,y=e[a];if(y===void 0){r.byPropertyKey.has(a)&&(i??=m({},r),i.byPropertyKey.delete(a));continue}s&&R(y)&&!p(y)&&(l=y[this.identitySymbol]??=Symbol(""));let A;l&&(r.byTrackingKey?.has(l)||(i??=m({},r),i.byTrackingKey??=new Map,i.byTrackingKey.set(l,this.createChildNode(a,l,s))),A=(i??r).byTrackingKey.get(l));let J=r.byPropertyKey.get(a);J===void 0?(i??=m({},r),i.byPropertyKey.set(a,{reader:this.createReader(a),node:A??this.createChildNode(a,l,s)})):A&&A!==J.node&&(i??=m({},r),J.node=A)}return i??r}})}createReader(e){return o(()=>this.childrenMap()?.byPropertyKey.get(e)?.node)}},Se=class extends Y{fieldManager;value;get parent(){}get root(){return this.node}get pathKeys(){return xt}get keyInParent(){return gt}childrenMap;constructor(e,n,r,i,s){super(n,e,s),this.fieldManager=r,this.value=i,this.childrenMap=this.createChildrenMap()}},we=class extends Y{logic;parent;root;pathKeys;keyInParent;value;childrenMap;get fieldManager(){return this.root.structure.fieldManager}constructor(e,n,r,i,s,a){super(n,e,a),this.logic=n,this.parent=r,this.root=this.parent.structure.root,this.keyInParent=this.createKeyInParent({kind:"child",parent:r,pathNode:void 0,logic:n,initialKeyInParent:s,identityInParent:i,fieldAdapter:void 0},i,s),this.pathKeys=o(()=>[...r.structure.pathKeys(),this.keyInParent()]),this.value=kt(this.parent.structure.value,this.keyInParent),this.childrenMap=this.createChildrenMap(),this.fieldManager.structures.add(this)}};var xt=o(()=>[]),gt=o(()=>{throw new h(1905,!1)});function _t(t,e,n){let r,i=new Set(t.byPropertyKey.keys()),s=new Set(t.byTrackingKey?.keys());for(let a=0;a<e.length;a++){let l=e[a];i.delete(a.toString()),R(l)&&l.hasOwnProperty(n)&&s.delete(l[n])}if(i.size>0){r??=m({},t);for(let a of i)r.byPropertyKey.delete(a)}if(s.size>0){r??=m({},t);for(let a of s)r.byTrackingKey?.delete(a)}return r}function Ot(t,e){let n;for(let r of t.byPropertyKey.keys())e.hasOwnProperty(r)||(n??=m({},t),n.byPropertyKey.delete(r));return n}var Ne=class{node;selfSubmitting=w(!1);serverErrors;constructor(e){this.node=e,this.serverErrors=x({source:this.node.structure.value,computation:()=>[]})}submitting=o(()=>this.selfSubmitting()||(this.node.structure.parent?.submitting()??!1))},L=class{structure;validationState;metadataState;nodeState;submitState;fieldAdapter;_context=void 0;get context(){return this._context??=new be(this)}fieldProxy=new Proxy(()=>this,It);pathNode;constructor(e){this.pathNode=e.pathNode,this.fieldAdapter=e.fieldAdapter,this.structure=this.fieldAdapter.createStructure(this,e),this.validationState=this.fieldAdapter.createValidationState(this,e),this.nodeState=this.fieldAdapter.createNodeState(this,e),this.metadataState=new ve(this),this.submitState=new Ne(this)}pendingSync=x({source:()=>this.value(),computation:(e,n)=>{n?.value?.abort()}});get logicNode(){return this.structure.logic}get value(){return this.structure.value}_controlValue=x(()=>this.value());get controlValue(){return this._controlValue.asReadonly()}get keyInParent(){return this.structure.keyInParent}get errors(){return this.validationState.errors}get errorSummary(){return this.validationState.errorSummary}get pending(){return this.validationState.pending}get valid(){return this.validationState.valid}get invalid(){return this.validationState.invalid}get dirty(){return this.nodeState.dirty}get touched(){return this.nodeState.touched}get disabled(){return this.nodeState.disabled}get disabledReasons(){return this.nodeState.disabledReasons}get hidden(){return this.nodeState.hidden}get readonly(){return this.nodeState.readonly}get fieldBindings(){return this.nodeState.fieldBindings}get submitting(){return this.submitState.submitting}get name(){return this.nodeState.name}get max(){return this.metadata(ct)}get maxLength(){return this.metadata(ft)}get min(){return this.metadata(lt)}get minLength(){return this.metadata(ht)}get pattern(){return this.metadata(mt)??Kt}get required(){return this.metadata(Pe)??Lt}metadata(e){return this.metadataState.get(e)}hasMetadata(e){return this.metadataState.has(e)}markAsTouched(){this.nodeState.markAsTouched(),this.pendingSync()?.abort(),this.sync()}markAsDirty(){this.nodeState.markAsDirty()}reset(e){f(()=>this._reset(e))}_reset(e){e!==void 0&&this.value.set(e),this.nodeState.markAsUntouched(),this.nodeState.markAsPristine();for(let n of this.structure.children())n._reset()}setControlValue(e){this._controlValue.set(e),this.markAsDirty(),this.debounceSync()}sync(){this.value.set(this.controlValue())}async debounceSync(){this.pendingSync()?.abort();let e=this.nodeState.debouncer();if(e){let n=new AbortController,r=e(n.signal);if(r&&(this.pendingSync.set(n),await r,n.signal.aborted))return}this.sync()}static newRoot(e,n,r,i){return i.newRoot(e,n,r,i)}createStructure(e){return e.kind==="root"?new Se(this,e.logic,e.fieldManager,e.value,this.newChild.bind(this)):new we(this,e.logic,e.parent,e.identityInParent,e.initialKeyInParent,this.newChild.bind(this))}newChild(e,n,r){let i,s;return r?(i=this.pathNode.getChild(M),s=this.structure.logic.getChild(M)):(i=this.pathNode.getChild(e),s=this.structure.logic.getChild(e)),this.fieldAdapter.newChild({kind:"child",parent:this,pathNode:i,logic:s,initialKeyInParent:e,identityInParent:n,fieldAdapter:this.fieldAdapter})}},Kt=o(()=>[]),Lt=o(()=>!1),Ee=class{node;selfTouched=w(!1);selfDirty=w(!1);markAsTouched(){this.selfTouched.set(!0)}markAsDirty(){this.selfDirty.set(!0)}markAsPristine(){this.selfDirty.set(!1)}markAsUntouched(){this.selfTouched.set(!1)}fieldBindings=w([]);constructor(e){this.node=e}dirty=o(()=>{let e=this.selfDirty()&&!this.isNonInteractive();return this.node.structure.reduceChildren(e,(n,r)=>r||n.nodeState.dirty(),at)});touched=o(()=>{let e=this.selfTouched()&&!this.isNonInteractive();return this.node.structure.reduceChildren(e,(n,r)=>r||n.nodeState.touched(),at)});disabledReasons=o(()=>[...this.node.structure.parent?.nodeState.disabledReasons()??[],...this.node.logicNode.logic.disabledReasons.compute(this.node.context)]);disabled=o(()=>!!this.disabledReasons().length);readonly=o(()=>(this.node.structure.parent?.nodeState.readonly()||this.node.logicNode.logic.readonly.compute(this.node.context))??!1);hidden=o(()=>(this.node.structure.parent?.nodeState.hidden()||this.node.logicNode.logic.hidden.compute(this.node.context))??!1);name=o(()=>{let e=this.node.structure.parent;return e?`${e.name()}.${this.node.structure.keyInParent()}`:this.node.structure.fieldManager.rootName});debouncer=o(()=>{if(this.node.logicNode.logic.hasMetadata(ye)){let n=this.node.logicNode.logic.getMetadata(ye).compute(this.node.context);if(n)return r=>n(this.node.context,r)}return this.node.structure.parent?.nodeState.debouncer?.()});isNonInteractive=o(()=>this.hidden()||this.disabled()||this.readonly())},Me=class{newRoot(e,n,r,i){return new L({kind:"root",fieldManager:e,value:n,pathNode:r,logic:r.builder.build(),fieldAdapter:i})}newChild(e){return new L(e)}createNodeState(e){return new Ee(e)}createValidationState(e){return new pe(e)}createStructure(e,n){return e.createStructure(n)}},De=class{injector;rootName;constructor(e,n){this.injector=e,this.rootName=n??`${this.injector.get(Le)}.form${jt++}`}structures=new Set;createFieldManagementEffect(e){j(()=>{let n=new Set;this.markStructuresLive(e,n);for(let r of this.structures)n.has(r)||(this.structures.delete(r),f(()=>r.destroy()))},{injector:this.injector})}markStructuresLive(e,n){n.add(e);for(let r of e.children())this.markStructuresLive(r.structure,n)}},jt=0;function Vt(t){let e,n,r;return t.length===3?[e,n,r]=t:t.length===2?Ct(t[1])?[e,n]=t:[e,r]=t:[e]=t,[e,n,r]}function Ae(...t){let[e,n,r]=Vt(t),i=r?.injector??S(I),s=re(i,()=>q.rootCompile(n)),a=new De(i,r?.name),l=r?.adapter??new Me,y=L.newRoot(a,e,s,l);return a.createFieldManagementEffect(y.structure),y.fieldProxy}async function Ie(t,e){let n=t();if(pt(n),!n.invalid()){n.submitState.selfSubmitting.set(!0);try{let r=await e(t);r&&Ut(n,r)}finally{n.submitState.selfSubmitting.set(!1)}}}function Ut(t,e){p(e)||(e=[e]);let n=new Map;for(let r of e){let i=Te(r,t.fieldProxy),s=i.fieldTree(),a=n.get(s);a||(a=[],n.set(s,a)),a.push(i)}for(let[r,i]of n)r.submitState.serverErrors.set(i)}function pt(t){t.markAsTouched();for(let e of t.structure.children())pt(e)}var Ht=new ne("");var ke=class{field;constructor(e){this.field=e}control=this;get value(){return this.field().value()}get valid(){return this.field().valid()}get invalid(){return this.field().invalid()}get pending(){return this.field().pending()}get disabled(){return this.field().disabled()}get enabled(){return!this.field().disabled()}get errors(){let e=this.field().errors();if(e.length===0)return null;let n={};for(let r of e)n[r.kind]=r;return n}get pristine(){return!this.field().dirty()}get dirty(){return this.field().dirty()}get touched(){return this.field().touched()}get untouched(){return!this.field().touched()}get status(){if(this.field().disabled())return"DISABLED";if(this.field().valid())return"VALID";if(this.field().invalid())return"INVALID";if(this.field().pending())return"PENDING";throw new h(1910,!1)}valueAccessor=null;hasValidator(e){return e===D.required?this.field().required():!1}updateValueAndValidity(){}},Bt=new ne(""),zt={create:k,update:Ge},bt=(()=>{class t{element=S(Ke).nativeElement;injector=S(I);field=$e.required();state=o(()=>this.field()());[je]=zt;config=S(Ht,{optional:!0});classes=Object.entries(this.config?.classes??{}).map(([n,r])=>[n,o(()=>r(this))]);controlValueAccessors=S(Ye,{optional:!0,self:!0});interopNgControl;get \u0275interopControl(){return this.controlValueAccessors?.[0]??this.interopNgControl?.valueAccessor??void 0}getOrCreateNgControl(){return this.interopNgControl??=new ke(this.state)}\u0275register(){j(n=>{let r=this.state();r.nodeState.fieldBindings.update(i=>[...i,this]),n(()=>{r.nodeState.fieldBindings.update(i=>i.filter(s=>s!==this))})},{injector:this.injector})}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Ue({type:t,selectors:[["","field",""]],inputs:{field:[1,"field"]},features:[ze([{provide:Bt,useExisting:t},{provide:Ze,useFactory:()=>S(t).getOrCreateNgControl()}])]})}return t})();function $t(t){return new xe(t)}function qt(t){return new _e(t)}function Xt(t){return new Fe(t)}var Fe=class{__brand=void 0;kind="";fieldTree;message;constructor(e){e&&Object.assign(this,e)}},Z=class{__brand=void 0;kind="";fieldTree;message;constructor(e){e&&Object.assign(this,e)}},xe=class extends Z{kind="required"};var _e=class extends Z{kind="email"};function Q(t,e){return t instanceof Function?t(e):t}function vt(t){return typeof t=="number"?isNaN(t):t===""||t===!1||t==null}function Yt(t){return typeof t=="object"&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function yt(t){return Yt(t)?Xt(t):t}function Wt(t){return t==null?t:p(t)?t.map(yt):yt(t)}function St(t,e){Re(t),b.unwrapFieldPath(t).builder.addSyncErrorRule(r=>Wt(Te(e(r),r.fieldTree)))}var Zt=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function wt(t,e){St(t,n=>{if(!vt(n.value())&&!Zt.test(n.value()))return e?.error?Q(e.error,n):qt({message:Q(e?.message,n)})})}function Oe(t,e){let n=Ce(t,v(),r=>e?.when?e.when(r):!0);Ce(t,Pe,({state:r})=>r.metadata(n)()),St(t,r=>{if(r.state.metadata(n)()&&vt(r.value()))return e?.error?Q(e.error,r):$t({message:Q(e?.message,r)})})}function Qt(t,e){t&1&&(u(0,"div",9)(1,"span",25),c(2,"Required"),d()())}function Jt(t,e){t&1&&(u(0,"div",9)(1,"span",25),c(2,"Invalid Email"),d()())}function en(t,e){if(t&1&&(u(0,"div",24)(1,"span"),c(2),de(3,"json"),d()()),t&2){let n=He();g(2),G("Last successful submission: ",ue(3,1,n.lastSubmission()))}}var Nt=class t{legacyForm=new tt({username:new le("",D.required),email:new le("",[D.required,D.email])});signalUser=w({username:"",email:""});signalForm=Ae(this.signalUser,e=>{Oe(e.username,{message:"Required"}),Oe(e.email,{message:"Required"}),wt(e.email,{message:"Invalid email"})});lastSubmission=w(null);programmaticUpdate(){this.signalForm.username().value.set("GenericUser_"+Math.floor(Math.random()*100))}onSubmit(e){e.preventDefault(),Ie(this.signalForm,async()=>{console.log("Form is valid, submitting...",this.signalUser()),this.lastSubmission.set(m({},this.signalUser()))})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=Ve({type:t,selectors:[["app-signal-forms-demo"]],decls:56,vars:24,consts:[[1,"card","bg-base-100","shadow-xl","m-4"],[1,"card-body"],[1,"card-title","text-2xl","mb-4"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"border","p-4","rounded-box","bg-base-200"],[1,"font-bold","text-lg","mb-2"],[1,"text-xs","mb-2"],[3,"formGroup"],[1,"form-control","w-full","max-w-xs"],[1,"label"],[1,"label-text"],["type","text","formControlName","username",1,"input","input-bordered","bg-base-100","w-full","max-w-xs"],[1,"form-control","w-full","max-w-xs","mt-2"],["type","text","formControlName","email",1,"input","input-bordered","bg-base-100","w-full","max-w-xs"],[1,"mt-4"],[1,"border","p-4","rounded-box","border-primary","bg-primary/5"],[1,"font-bold","text-lg","mb-2","text-primary"],[1,"mt-4",3,"submit"],["type","text",1,"input","input-bordered","input-primary","w-full","max-w-xs",3,"field"],[1,"flex","gap-2","mt-4"],["type","submit",1,"btn","btn-primary","disabled:btn-disabled",3,"disabled"],["type","button",1,"btn","btn-outline","btn-accent",3,"click"],[1,"mt-6"],[1,"mockup-code","bg-primary","text-primary-content","p-2","text-xs"],[1,"alert","alert-success","mt-4","shadow-sm","text-sm"],[1,"label-text-alt","text-error"]],template:function(n,r){n&1&&(u(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"Evolution of Forms"),d(),u(4,"div",3)(5,"div",4)(6,"h3",5),c(7,"Legacy (Reactive Forms)"),d(),u(8,"p",6),c(9," Requires ControlValueAccessor, manual subscriptions, boilerplate. "),d(),u(10,"form",7)(11,"div",8)(12,"label",9)(13,"span",10),c(14,"Username"),d()(),F(15,"input",11),d(),u(16,"div",12)(17,"label",9)(18,"span",10),c(19,"Email"),d()(),F(20,"input",13),d(),u(21,"div",14)(22,"p"),c(23),de(24,"json"),d(),u(25,"p"),c(26),d()()()(),u(27,"div",15)(28,"h3",16),c(29,"Signal Forms (v21)"),d(),u(30,"p",6),c(31,"Model-driven, type-safe, default signals."),d(),u(32,"form",17),ae("submit",function(s){return r.onSubmit(s)}),u(33,"div",8)(34,"label",9)(35,"span",10),c(36,"Username"),d()(),F(37,"input",18),k(),V(38,Qt,3,0,"div",9),d(),u(39,"div",12)(40,"label",9)(41,"span",10),c(42,"Email"),d()(),F(43,"input",18),k(),V(44,Jt,3,0,"div",9),d(),u(45,"div",19)(46,"button",20),c(47," Submit (Signal) "),d(),u(48,"button",21),ae("click",function(){return r.programmaticUpdate()}),c(49," Simulate API Update "),d()()(),u(50,"div",22)(51,"div",23)(52,"pre")(53,"code"),c(54),d()()(),V(55,en,4,3,"div",24),d()()()()()),n&2&&(g(10),se("formGroup",r.legacyForm),g(13),G("Value: ",ue(24,22,r.legacyForm.value)),g(3),G("Valid: ",r.legacyForm.valid),g(11),ie(r.signalForm.username),oe("input-error",r.signalForm.username().invalid()),g(),U(r.signalForm.username().invalid()?38:-1),g(5),ie(r.signalForm.email),oe("input-error",r.signalForm.email().invalid()),g(),U(r.signalForm.email().invalid()?44:-1),g(2),se("disabled",r.signalForm().pending()||r.signalForm().invalid()),g(8),Be("name: ",r.signalUser().username,`
email: `,r.signalUser().email,`
isValid: `,r.signalForm().valid(),`

// Access via FieldState
username.value(): `,r.signalForm.username().value(),`
email.value(): `,r.signalForm.email().value(),`
username.valid(): `,r.signalForm.username().valid(),`
email.valid(): `,r.signalForm.email().valid()),g(),U(r.lastSubmission()?55:-1))},dependencies:[Xe,st,nt,We,Qe,Je,it,rt,bt,qe],encapsulation:2,changeDetection:0})};export{Nt as SignalFormsDemoComponent};
